C51 COMPILER V9.01   SERIAL                                                                01/01/2017 23:40:39 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE SERIAL
OBJECT MODULE PLACED IN serial.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE serial.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg52.h>
   2          #include <serial.h>
   3          #include "moto.h"
   4          #include "is_compatible.h"
   5          #include "delay.h"
   6          
   7          #define ALLOWABLE_STATION  ((car_station_current >= STATION_CAR_GO) &&(car_station_current <= STATION_CAR_
             -STOP))?(true):(false)
   8          
   9          unsigned char receive_buf[3];
  10          unsigned char receive_count;
  11          int car_station_current = STATION_CAR_STOP;
  12          int number_station_current = STATION_NUMBER_0;
  13          bool receive_control_flag = false;
  14          
  15          void sint() interrupt 4   
  16          {  
  17   1        if(RI){                  
  18   2          RI=0;
  19   2          receive_buf[receive_count]=SBUF;
  20   2          receive_count++;
  21   2          if(receive_count==3) 
  22   2          {
  23   3          receive_control_flag = true;
  24   3          switch(receive_buf[2]){
  25   4            case 'A'://前进
  26   4              car_station_current = STATION_CAR_GO;
  27   4              break;
  28   4            case 'B'://后退
  29   4              car_station_current = STATION_CAR_BACK;
  30   4              break;
  31   4            case 'C'://左转
  32   4              car_station_current = STATION_CAR_LEFT;
  33   4              break;
  34   4            case 'D'://右转
  35   4              car_station_current = STATION_CAR_RIGHT;
  36   4              break;
  37   4            case 'F'://stop
  38   4              car_station_current = STATION_CAR_STOP;
  39   4              break;  
  40   4      
  41   4            case '1':
  42   4              number_station_current = STATION_NUMBER_1;
  43   4              break;
  44   4            case '2':
  45   4              number_station_current = STATION_NUMBER_2;
  46   4              break;
  47   4            case '3':
  48   4              number_station_current = STATION_NUMBER_3;
  49   4              break;
  50   4            case '4':
  51   4              number_station_current = STATION_NUMBER_4;
  52   4              break;
  53   4            case '5':
  54   4              number_station_current = STATION_NUMBER_5;
C51 COMPILER V9.01   SERIAL                                                                01/01/2017 23:40:39 PAGE 2   

  55   4              break;
  56   4            case '6':
  57   4              number_station_current = STATION_NUMBER_6;
  58   4              break;
  59   4            case '7':
  60   4              number_station_current = STATION_NUMBER_7;
  61   4              break;
  62   4            case '8':
  63   4              number_station_current = STATION_NUMBER_8;
  64   4              break;
  65   4            case '9':
  66   4              number_station_current = STATION_NUMBER_9;
  67   4              break;
  68   4            default:
  69   4              car_station_current = STATION_CAR_STOP;
  70   4              number_station_current = STATION_NUMBER_0;
  71   4              break;
  72   4          } 
  73   3            receive_count=0;
  74   3            receive_control_flag = false;
  75   3          }
  76   2      
  77   2        }
  78   1      }   
  79          
  80          void serial_init(void)
  81          {
  82   1        TMOD=0x20;  
  83   1        TH1=0xFd;        //11.0592M,9600
  84   1        TL1=0xFd;
  85   1        SCON=0x50;  
  86   1        PCON=0x00; 
  87   1        TR1=1;
  88   1        ES=1;   
  89   1        EA=1; 
  90   1      }
  91          
  92          void serial_control_car(void)
  93          {
  94   1        if(ALLOWABLE_STATION == true)
  95   1        {
  96   2            switch(car_station_current)
  97   2            {
  98   3             case STATION_CAR_GO :
  99   3             {
 100   4               car_go(9);
 101   4               //delayms(100);
 102   4               break;
 103   4             }
 104   3             
 105   3             case STATION_CAR_BACK :
 106   3             {
 107   4               car_back(9);
 108   4               //delayms(100);
 109   4               break;
 110   4             }
 111   3             
 112   3             case STATION_CAR_LEFT :
 113   3             {
 114   4               car_left(7);
 115   4               //delayms(100);
 116   4               break;
C51 COMPILER V9.01   SERIAL                                                                01/01/2017 23:40:39 PAGE 3   

 117   4             }
 118   3             
 119   3             case STATION_CAR_RIGHT :
 120   3             { 
 121   4               car_right(7);
 122   4               //delayms(100);
 123   4               break;
 124   4             }
 125   3             
 126   3             case STATION_CAR_STOP :
 127   3             {
 128   4               car_stop();
 129   4               break;
 130   4             }
 131   3            }
 132   2          }
 133   1          else
 134   1          {
 135   2          car_stop();
 136   2          }
 137   1        
 138   1      }
 139          
 140          int get_serial_number(void)
 141          {
 142   1        return number_station_current;
 143   1      }
 144          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    348    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
